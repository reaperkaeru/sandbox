<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
    <link rel="manifest" href="?action=manifest">
    <title>Spiral Development Group Portal</title>
    <style>
      :root {
        --primary: #007bff;
        --primary-light: rgba(0, 123, 255, 0.08);
        --surface: #ffffff;
        --surface-alt: #f5f5f5;
        --surface-tan: #f7efe3;
        --text: #222222;
        --text-muted: #6c757d;
        --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      }

      [data-theme='dark'] {
        --surface: #1f1f28;
        --surface-alt: #2a2a35;
        --surface-tan: #3a2f24;
        --text: #f8f9fa;
        --text-muted: #adb5bd;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: 'Rajdhani', sans-serif;
        background: var(--surface-alt);
        color: var(--text);
        transition: background 0.4s ease, color 0.4s ease;
        scroll-behavior: smooth;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .app-wrapper {
        display: flex;
        min-height: 100vh;
      }

      aside.sidebar {
        width: 260px;
        background: var(--surface);
        box-shadow: var(--shadow);
        padding: 20px 16px;
        position: sticky;
        top: 0;
        height: 100vh;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .logo-block {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 8px;
        padding: 16px;
        border-radius: 16px;
        background: var(--surface-alt);
        transition: background 0.3s ease;
      }

      body[data-theme='dark'] .logo-block {
        background: rgba(255, 255, 255, 0.05);
      }

      .logo-block img {
        width: 120px;
        height: auto;
        border-radius: 12px;
        background: var(--logo-bg, rgba(255, 255, 255, 0.9));
        padding: 8px;
        transition: background 0.3s ease;
      }

      .logo-block h1 {
        font-size: 20px;
        margin: 0;
        font-weight: 600;
      }

      .nav-links {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .nav-links a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 14px;
        border-radius: 14px;
        font-weight: 600;
        color: var(--text-muted);
        transition: background 0.3s ease, color 0.3s ease, transform 0.3s ease;
      }

      .nav-links a:hover,
      .nav-links a.active {
        background: var(--primary-light);
        color: var(--primary);
        transform: translateX(4px);
      }

      .nav-links .material-icons-outlined {
        font-size: 20px;
      }

      .sidebar-footer {
        margin-top: auto;
        font-size: 13px;
        color: var(--text-muted);
      }

      main.content {
        flex: 1;
        padding: 0 24px 80px;
      }

      header.app-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 24px 0;
        position: sticky;
        top: 0;
        background: linear-gradient(135deg, rgba(0, 123, 255, 0.12), transparent);
        z-index: 10;
        backdrop-filter: blur(10px);
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .toggle {
        border: none;
        background: var(--surface);
        border-radius: 30px;
        padding: 10px 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        box-shadow: var(--shadow);
        cursor: pointer;
        font-weight: 600;
        transition: transform 0.3s ease;
      }

      .toggle:hover {
        transform: translateY(-2px);
      }

      section.panel {
        background: var(--surface);
        border-radius: 24px;
        padding: 28px;
        margin-bottom: 32px;
        box-shadow: var(--shadow);
        opacity: 0;
        transform: translateY(20px);
        animation: fadeIn 0.8s forwards;
      }

      @keyframes fadeIn {
        to {
          opacity: 1;
          transform: none;
        }
      }

      .hero {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 24px;
        align-items: center;
      }

      .hero img {
        width: 100%;
        max-width: 220px;
        justify-self: center;
      }

      .hero-text h2 {
        font-size: 32px;
        margin: 0 0 8px;
      }

      .hero-text p {
        margin: 0;
        color: var(--text-muted);
        font-size: 18px;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
        margin-top: 24px;
      }

      .stat-card {
        background: linear-gradient(145deg, var(--surface), var(--surface-alt));
        border-radius: 20px;
        padding: 20px;
        box-shadow: var(--shadow);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-6px);
        box-shadow: 0 18px 40px rgba(0, 123, 255, 0.18);
      }

      .stat-card h3 {
        margin: 0;
        font-size: 14px;
        color: var(--text-muted);
        letter-spacing: 1.2px;
      }

      .stat-card p {
        font-size: 32px;
        margin: 6px 0 0;
        font-weight: 700;
      }

      .tab-group {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .table-wrapper {
        overflow-x: auto;
        border-radius: 18px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        padding: 14px 16px;
        text-align: left;
      }

      thead {
        background: var(--primary);
        color: #ffffff;
      }

      tbody tr:nth-child(even) {
        background: var(--surface-alt);
      }

      tbody tr:hover {
        background: rgba(0, 123, 255, 0.1);
      }

      .fab {
        position: sticky;
        bottom: 20px;
        margin-left: auto;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: var(--primary);
        color: #fff;
        border: none;
        font-size: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 18px 40px rgba(0, 123, 255, 0.35);
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .fab:hover {
        transform: translateY(-4px) scale(1.02);
      }

      .card-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 16px;
      }

      .info-card {
        background: var(--surface);
        border-radius: 18px;
        padding: 18px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .info-card h4 {
        margin: 0;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .info-card p {
        margin: 0;
        color: var(--text-muted);
      }

      .status-icon {
        font-size: 18px;
      }

      form {
        display: grid;
        gap: 12px;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid rgba(0, 0, 0, 0.08);
        background: var(--surface-alt);
        color: inherit;
        font-family: inherit;
        transition: border 0.2s ease, background 0.2s ease;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--primary);
        background: #ffffff;
      }

      button.primary {
        background: var(--primary);
        border: none;
        color: #ffffff;
        padding: 12px 16px;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 12px 30px rgba(0, 123, 255, 0.25);
      }

      button.primary:hover {
        transform: translateY(-2px);
      }

      .login-card {
        max-width: 420px;
        margin: 0 auto;
        text-align: center;
      }

      .login-card h2 {
        margin-bottom: 16px;
      }

      .error-message {
        color: #dc3545;
        font-weight: 600;
      }

      .mobile-bottom-nav {
        display: none;
      }

      .recent-projects {
        margin-top: 24px;
      }

      .chip {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 6px 10px;
        border-radius: 20px;
        background: var(--surface-alt);
        font-size: 13px;
        color: var(--text-muted);
      }

      .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--primary);
        color: #fff;
        padding: 14px 18px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.4s ease, transform 0.4s ease;
        z-index: 30;
      }

      .toast.show {
        opacity: 1;
        transform: none;
      }

      .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.4);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 50;
      }

      .loading-overlay.active {
        display: flex;
      }

      .spinner {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        border: 6px solid rgba(255, 255, 255, 0.3);
        border-top-color: #ffffff;
        animation: spin 0.8s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 960px) {
        .app-wrapper {
          flex-direction: column;
        }

        aside.sidebar {
          display: none;
        }

        main.content {
          padding: 0 16px 120px;
        }

        header.app-header {
          padding: 20px 0;
        }

        .mobile-bottom-nav {
          display: grid;
          grid-template-columns: repeat(4, 1fr);
          position: fixed;
          bottom: 0;
          left: 0;
          right: 0;
          background: var(--surface);
          box-shadow: 0 -10px 20px rgba(0, 0, 0, 0.08);
          z-index: 25;
        }

        .mobile-bottom-nav button {
          background: transparent;
          border: none;
          padding: 12px 0;
          font-size: 22px;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          color: var(--text-muted);
          font-weight: 600;
        }

        .mobile-bottom-nav button.active {
          color: var(--primary);
        }
      }
    </style>
  </head>
  <body data-theme="light">
    <div class="loading-overlay" id="loadingOverlay">
      <div class="spinner"></div>
    </div>
    <!-- End Loading Overlay / Fin de la Superposición de Carga -->

    <div class="toast" id="toast"></div>
    <!-- End Toast Component / Fin del Componente de Notificaciones -->

    <div class="app-wrapper">
      <aside class="sidebar" id="desktopSidebar">
        <div class="logo-block">
          <img src="https://i.imgur.com/mRLfOoI.png" alt="Spiral Development Group" id="logoImage" />
          <h1>Spiral Development</h1>
          <p data-i18n="sidebarSubtitle">Innovation in motion</p>
        </div>
        <nav class="nav-links">
          <a href="#dashboard" class="active" data-nav="dashboard"><span class="material-icons-outlined">home</span><span data-i18n="navDashboard">Dashboard</span></a>
          <a href="#projects" data-nav="projects"><span class="material-icons-outlined">folder</span><span data-i18n="navProjects">Projects</span></a>
          <a href="#tasks" data-nav="tasks"><span class="material-icons-outlined">check_circle</span><span data-i18n="navTasks">Tasks</span></a>
          <a href="#reports" data-nav="reports"><span class="material-icons-outlined">insights</span><span data-i18n="navReports">Reports</span></a>
          <a href="#users" data-nav="users"><span class="material-icons-outlined">group</span><span data-i18n="navUsers">Users</span></a>
          <a href="#settings" data-nav="settings"><span class="material-icons-outlined">settings</span><span data-i18n="navSettings">Settings</span></a>
        </nav>
        <div class="sidebar-footer" data-i18n="sidebarFooter">Empowering Spiral Development Group</div>
      </aside>
      <!-- End Desktop Sidebar / Fin de la Barra Lateral de Escritorio -->

      <main class="content">
        <header class="app-header">
          <div>
            <h2 id="welcomeMessage" data-i18n="welcome">Welcome</h2>
            <span class="chip" id="roleChip">Role</span>
          </div>
          <div class="header-actions">
            <button class="toggle" id="languageToggle"><span class="material-icons-outlined">translate</span><span data-i18n="toggleLanguage">ES</span></button>
            <button class="toggle" id="themeToggle"><span class="material-icons-outlined">dark_mode</span><span data-i18n="toggleTheme">Dark</span></button>
            <button class="toggle" id="logoutButton" style="display: none"><span class="material-icons-outlined">logout</span><span data-i18n="logout">Logout</span></button>
          </div>
        </header>
        <!-- End Header Section / Fin de la Sección de Encabezado -->

        <section class="panel" id="loginSection">
          <div class="login-card">
            <h2 data-i18n="loginTitle">Secure Login</h2>
            <p data-i18n="loginSubtitle">Access the Spiral workspace</p>
            <form id="loginForm">
              <input type="email" name="email" placeholder="Email" required data-i18n-placeholder="emailPlaceholder" />
              <input type="password" name="password" placeholder="Password" required data-i18n-placeholder="passwordPlaceholder" />
              <button class="primary" type="submit" data-i18n="loginButton">Sign In</button>
              <div class="error-message" id="loginError"></div>
            </form>
          </div>
        </section>
        <!-- End Login Section / Fin de la Sección de Inicio de Sesión -->

        <section class="panel" id="dashboard">
          <div class="hero">
            <div class="hero-text">
              <h2 id="greeting" data-i18n="greeting">Good morning</h2>
              <p data-i18n="heroSubtitle">Track your projects, tasks, and time seamlessly.</p>
            </div>
            <img src="https://i.imgur.com/mRLfOoI.png" alt="Spiral Logo" />
          </div>
          <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
              <h3 data-i18n="statMyTasks">My Tasks</h3>
              <p id="statTasks">0</p>
            </div>
            <div class="stat-card">
              <h3 data-i18n="statMyHours">My Hours</h3>
              <p id="statHours">0</p>
            </div>
            <div class="stat-card">
              <h3 data-i18n="statRecentProjects">Recent Projects</h3>
              <p id="statProjects">0</p>
            </div>
          </div>
        </section>
        <!-- End Dashboard Section / Fin de la Sección del Tablero -->

        <section class="panel" id="projects">
          <header style="display: flex; justify-content: space-between; align-items: center; gap: 16px; flex-wrap: wrap;">
            <div>
              <h3 data-i18n="projectsTitle">Projects</h3>
              <p data-i18n="projectsSubtitle">Monitor progress and status at a glance.</p>
            </div>
            <button class="fab" id="addProjectFab">+</button>
          </header>
          <div class="table-wrapper">
            <table id="projectsTable">
              <thead>
                <tr>
                  <th data-i18n="thProject">Project</th>
                  <th data-i18n="thStatus">Status</th>
                  <th data-i18n="thUpdated">Updated</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card-list" id="projectsCards"></div>
          <div class="recent-projects">
            <h4 data-i18n="recentProjects">Recent Projects</h4>
            <ul id="recentProjectsList"></ul>
          </div>
        </section>
        <!-- End Projects Section / Fin de la Sección de Proyectos -->

        <section class="panel" id="tasks">
          <header style="display: flex; justify-content: space-between; align-items: center; gap: 16px; flex-wrap: wrap;">
            <div>
              <h3 data-i18n="tasksTitle">Tasks</h3>
              <p data-i18n="tasksSubtitle">Organize personal and communal work.</p>
            </div>
            <button class="fab" id="addTaskFab">+</button>
          </header>
          <div class="table-wrapper">
            <table id="tasksTable">
              <thead>
                <tr>
                  <th data-i18n="thTask">Task</th>
                  <th data-i18n="thPriority">Priority</th>
                  <th data-i18n="thDue">Due</th>
                  <th data-i18n="thStatus">Status</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="card-list" id="tasksCards"></div>
        </section>
        <!-- End Tasks Section / Fin de la Sección de Tareas -->

        <section class="panel" id="reports">
          <h3 data-i18n="reportsTitle">Reports & Insights</h3>
          <p data-i18n="reportsDescription">Review diagnostic status and overall health.</p>
          <button class="primary" id="diagnosticsButton" data-i18n="runDiagnostics">Run diagnostics</button>
          <div id="diagnosticsResults"></div>
        </section>
        <!-- End Reports Section / Fin de la Sección de Reportes -->

        <section class="panel" id="users">
          <h3 data-i18n="usersTitle">Team Members</h3>
          <p data-i18n="usersSubtitle">Admin-only management tools.</p>
          <form id="addUserForm" style="display: none;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px;">
              <input name="name" placeholder="Name" required data-i18n-placeholder="namePlaceholder" />
              <input name="email" type="email" placeholder="Email" required data-i18n-placeholder="emailPlaceholder" />
              <select name="role" required>
                <option value="" disabled selected data-i18n="selectRole">Select role</option>
                <option value="Admin">Admin</option>
                <option value="Manager">Manager</option>
                <option value="Staff">Staff</option>
              </select>
              <select name="language">
                <option value="en">English</option>
                <option value="es">Español</option>
              </select>
              <select name="notifications">
                <option value="Enabled">Enabled</option>
                <option value="Disabled">Disabled</option>
              </select>
            </div>
            <button class="primary" type="submit" data-i18n="addUser">Add user</button>
          </form>
          <div class="table-wrapper" style="margin-top: 18px;">
            <table id="usersTable">
              <thead>
                <tr>
                  <th data-i18n="thName">Name</th>
                  <th data-i18n="thEmail">Email</th>
                  <th data-i18n="thRole">Role</th>
                  <th data-i18n="thLanguage">Language</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
        <!-- End Users Section / Fin de la Sección de Usuarios -->

        <section class="panel" id="settings">
          <h3 data-i18n="settingsTitle">Time Tracking</h3>
          <p data-i18n="settingsSubtitle">Toggle the workday timer.</p>
          <button class="primary" id="timeToggle" data-i18n="startDay">Start Day</button>
          <div class="table-wrapper" style="margin-top: 16px;">
            <table id="logsTable">
              <thead>
                <tr>
                  <th data-i18n="thDate">Date</th>
                  <th data-i18n="thStart">Start</th>
                  <th data-i18n="thEnd">End</th>
                  <th data-i18n="thDuration">Duration</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </section>
        <!-- End Settings/Logs Section / Fin de la Sección de Configuración/Registros -->
      </main>
      <!-- End Main Content / Fin del Contenido Principal -->
    </div>

    <nav class="mobile-bottom-nav" id="mobileNav">
      <button data-nav="dashboard" class="active">🏠<span data-i18n="navDashboard">Dashboard</span></button>
      <button data-nav="tasks">✅<span data-i18n="navTasks">Tasks</span></button>
      <button data-nav="reports">📊<span data-i18n="navReports">Reports</span></button>
      <button data-nav="users">👤<span data-i18n="navUsers">Users</span></button>
    </nav>
    <!-- End Mobile Navigation / Fin de la Navegación Móvil -->

    <template id="projectCardTemplate">
      <article class="info-card">
        <h4><span class="material-icons-outlined">folder</span><span class="name"></span></h4>
        <p class="description"></p>
        <div class="chip status"></div>
      </article>
    </template>
    <!-- End Project Card Template / Fin de la Plantilla de Tarjeta de Proyecto -->

    <template id="taskCardTemplate">
      <article class="info-card">
        <h4><span class="priority"></span><span class="name"></span></h4>
        <p class="description"></p>
        <div class="chip details"></div>
      </article>
    </template>
    <!-- End Task Card Template / Fin de la Plantilla de Tarjeta de Tarea -->

    <script>
      const i18n = {
        en: {
          sidebarSubtitle: 'Innovation in motion',
          navDashboard: 'Dashboard',
          navProjects: 'Projects',
          navTasks: 'Tasks',
          navReports: 'Reports',
          navUsers: 'Users',
          navSettings: 'Settings',
          sidebarFooter: 'Empowering Spiral Development Group',
          welcome: 'Welcome',
          toggleLanguage: 'ES',
          toggleTheme: 'Dark',
          logout: 'Logout',
          loginTitle: 'Secure Login',
          loginSubtitle: 'Access the Spiral workspace',
          loginButton: 'Sign In',
          greeting: 'Good morning',
          heroSubtitle: 'Track your projects, tasks, and time seamlessly.',
          statMyTasks: 'My Tasks',
          statMyHours: 'My Hours',
          statRecentProjects: 'Recent Projects',
          projectsTitle: 'Projects',
          projectsSubtitle: 'Monitor progress and status at a glance.',
          tasksTitle: 'Tasks',
          tasksSubtitle: 'Organize personal and communal work.',
          reportsTitle: 'Reports & Insights',
          reportsDescription: 'Review diagnostic status and overall health.',
          runDiagnostics: 'Run diagnostics',
          usersTitle: 'Team Members',
          usersSubtitle: 'Admin-only management tools.',
          addUser: 'Add user',
          settingsTitle: 'Time Tracking',
          settingsSubtitle: 'Toggle the workday timer.',
          startDay: 'Start Day',
          endDay: 'End Day',
          projectsEmpty: 'No projects available.',
          tasksEmpty: 'No tasks to display.',
          diagnosticsHeader: 'Diagnostics summary',
          timeStarted: 'Day started',
          timeEnded: 'Day finished',
          toastTaskCreated: 'Task created successfully',
          toastProjectCreated: 'Project created successfully',
          toastUserAdded: 'User added successfully',
          toastDiagnostics: 'Diagnostics completed',
          toastError: 'Something went wrong',
          toastLogin: 'Welcome back!',
          thProject: 'Project',
          thStatus: 'Status',
          thUpdated: 'Updated',
          thTask: 'Task',
          thPriority: 'Priority',
          thDue: 'Due',
          thName: 'Name',
          thEmail: 'Email',
          thRole: 'Role',
          thLanguage: 'Language',
          thDate: 'Date',
          thStart: 'Start',
          thEnd: 'End',
          thDuration: 'Duration',
          recentProjects: 'Recent Projects',
          emailPlaceholder: 'Email',
          passwordPlaceholder: 'Password',
          namePlaceholder: 'Name',
          selectRole: 'Select role'
        },
        es: {
          sidebarSubtitle: 'Innovación en movimiento',
          navDashboard: 'Panel',
          navProjects: 'Proyectos',
          navTasks: 'Tareas',
          navReports: 'Reportes',
          navUsers: 'Usuarios',
          navSettings: 'Ajustes',
          sidebarFooter: 'Impulsando a Spiral Development Group',
          welcome: 'Bienvenido',
          toggleLanguage: 'EN',
          toggleTheme: 'Claro',
          logout: 'Cerrar sesión',
          loginTitle: 'Acceso Seguro',
          loginSubtitle: 'Ingresa al espacio de trabajo Spiral',
          loginButton: 'Entrar',
          greeting: 'Buenos días',
          heroSubtitle: 'Controla tus proyectos, tareas y tiempo sin esfuerzo.',
          statMyTasks: 'Mis tareas',
          statMyHours: 'Mis horas',
          statRecentProjects: 'Proyectos recientes',
          projectsTitle: 'Proyectos',
          projectsSubtitle: 'Supervisa el progreso y estatus al instante.',
          tasksTitle: 'Tareas',
          tasksSubtitle: 'Organiza trabajo personal y comunal.',
          reportsTitle: 'Reportes e Insights',
          reportsDescription: 'Revisa diagnósticos y el estado general.',
          runDiagnostics: 'Ejecutar diagnósticos',
          usersTitle: 'Miembros del equipo',
          usersSubtitle: 'Herramientas solo para administradores.',
          addUser: 'Agregar usuario',
          settingsTitle: 'Registro de tiempo',
          settingsSubtitle: 'Controla el temporizador laboral.',
          startDay: 'Iniciar Día',
          endDay: 'Terminar Día',
          projectsEmpty: 'No hay proyectos disponibles.',
          tasksEmpty: 'No hay tareas para mostrar.',
          diagnosticsHeader: 'Resumen de diagnósticos',
          timeStarted: 'Jornada iniciada',
          timeEnded: 'Jornada finalizada',
          toastTaskCreated: 'Tarea creada correctamente',
          toastProjectCreated: 'Proyecto creado correctamente',
          toastUserAdded: 'Usuario agregado correctamente',
          toastDiagnostics: 'Diagnóstico completado',
          toastError: 'Ocurrió un problema',
          toastLogin: '¡Bienvenido de nuevo!',
          thProject: 'Proyecto',
          thStatus: 'Estado',
          thUpdated: 'Actualizado',
          thTask: 'Tarea',
          thPriority: 'Prioridad',
          thDue: 'Entrega',
          thName: 'Nombre',
          thEmail: 'Correo',
          thRole: 'Rol',
          thLanguage: 'Idioma',
          thDate: 'Fecha',
          thStart: 'Inicio',
          thEnd: 'Fin',
          thDuration: 'Duración',
          recentProjects: 'Proyectos recientes',
          emailPlaceholder: 'Correo',
          passwordPlaceholder: 'Contraseña',
          namePlaceholder: 'Nombre',
          selectRole: 'Selecciona un rol'
        }
      };
      // End translation dictionary section / Fin de la sección del diccionario de traducción

      let authToken = null;
      let currentUser = null;
      let currentLanguage = localStorage.getItem('spiralLanguage') || 'en';
      let currentTheme = localStorage.getItem('spiralTheme') || 'light';
      let hasOpenLog = false;

      document.addEventListener('DOMContentLoaded', () => {
        applyLanguage(currentLanguage);
        applyTheme(currentTheme);
        setupEventListeners();
        registerServiceWorker();
      });
      // End DOMContentLoaded section / Fin de la sección DOMContentLoaded

      function setupEventListeners() {
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
        document.getElementById('languageToggle').addEventListener('click', toggleLanguage);
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        document.getElementById('logoutButton').addEventListener('click', handleLogout);
        document.getElementById('addProjectFab').addEventListener('click', openProjectPrompt);
        document.getElementById('addTaskFab').addEventListener('click', openTaskPrompt);
        document.getElementById('diagnosticsButton').addEventListener('click', runDiagnostics);
        document.getElementById('timeToggle').addEventListener('click', toggleTimeLog);
        document.getElementById('addUserForm').addEventListener('submit', submitNewUser);

        document.querySelectorAll('[data-nav]').forEach((el) => {
          el.addEventListener('click', (event) => {
            if (el.tagName === 'BUTTON') {
              event.preventDefault();
            }
            const target = el.getAttribute('data-nav');
            document.querySelectorAll('[data-nav]').forEach((link) => link.classList.remove('active'));
            document.querySelectorAll(`[data-nav="${target}"]`).forEach((link) => link.classList.add('active'));
            const section = document.getElementById(target);
            if (section) {
              section.scrollIntoView({ behavior: 'smooth' });
            }
          });
        });
      }
      // End event listener setup section / Fin de la sección de configuración de eventos

      function handleLogin(event) {
        event.preventDefault();
        const form = event.target;
        const email = form.email.value.trim();
        const password = form.password.value;
        showSpinner(true);
        google.script.run
          .withSuccessHandler((response) => {
            showSpinner(false);
            if (response && response.success) {
              authToken = response.token;
              currentUser = response.user;
              currentLanguage = currentUser.language || currentLanguage;
              localStorage.setItem('spiralLanguage', currentLanguage);
              applyLanguage(currentLanguage);
              document.getElementById('loginError').textContent = '';
              document.getElementById('loginSection').style.display = 'none';
              document.getElementById('logoutButton').style.display = 'flex';
              updateWelcome();
              loadAllData();
              showToast(i18n[currentLanguage].toastLogin);
              document.getElementById('dashboard').scrollIntoView({ behavior: 'smooth' });
            }
          })
          .withFailureHandler((error) => {
            showSpinner(false);
            document.getElementById('loginError').textContent = error.message || i18n[currentLanguage].toastError;
          })
          .login(email, password);
      }
      // End login handler section / Fin de la sección del manejador de inicio de sesión

      function handleLogout() {
        if (!authToken) return;
        showSpinner(true);
        google.script.run
          .withSuccessHandler(() => {
            showSpinner(false);
            authToken = null;
            currentUser = null;
            hasOpenLog = false;
            document.getElementById('logoutButton').style.display = 'none';
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('loginForm').reset();
            showToast('Goodbye / Adiós');
          })
          .withFailureHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastError);
          })
          .logout(authToken);
      }
      // End logout handler section / Fin de la sección del manejador de cierre de sesión

      function loadAllData() {
        if (!authToken) return;
        showSpinner(true);
        const sessionPromise = new Promise((resolve) => {
          google.script.run
            .withSuccessHandler((res) => {
              if (res && res.user) {
                currentUser = res.user;
                updateWelcome();
              }
              resolve();
            })
            .withFailureHandler(() => resolve())
            .getCurrentUser(authToken);
        });
        const projectPromise = new Promise((resolve) => {
          google.script.run
            .withSuccessHandler((res) => {
              renderProjects(res.projects || [], res.recentProjects || []);
              resolve();
            })
            .withFailureHandler(() => {
              renderProjects([], []);
              resolve();
            })
            .getProjects(authToken);
        });

        const taskPromise = new Promise((resolve) => {
          google.script.run
            .withSuccessHandler((res) => {
              renderTasks(res.tasks || []);
              resolve();
            })
            .withFailureHandler(() => {
              renderTasks([]);
              resolve();
            })
            .getTasks(authToken);
        });

        const logsPromise = new Promise((resolve) => {
          if (!currentUser) {
            renderLogs([]);
            resolve();
            return;
          }
          google.script.run
            .withSuccessHandler((res) => {
              renderLogs(res.logs || []);
              resolve();
            })
            .withFailureHandler(() => {
              renderLogs([]);
              resolve();
            })
            .getLogsByUser(currentUser.id, authToken);
        });

        const usersPromise = new Promise((resolve) => {
          google.script.run
            .withSuccessHandler((res) => {
              renderUsers(res.users || []);
              resolve();
            })
            .withFailureHandler(() => resolve())
            .getUsers(authToken);
        });

        Promise.all([sessionPromise, projectPromise, taskPromise, logsPromise, usersPromise]).then(() => {
          updateStats();
          configureAdminVisibility();
          showSpinner(false);
        });
      }
      // End data loading section / Fin de la sección de carga de datos

      function renderProjects(projects, recent) {
        const tbody = document.querySelector('#projectsTable tbody');
        tbody.innerHTML = '';
        const cardsContainer = document.getElementById('projectsCards');
        cardsContainer.innerHTML = '';
        const list = document.getElementById('recentProjectsList');
        list.innerHTML = '';

        if (!projects.length) {
          const row = document.createElement('tr');
          const cell = document.createElement('td');
          cell.colSpan = 3;
          cell.textContent = i18n[currentLanguage].projectsEmpty;
          row.appendChild(cell);
          tbody.appendChild(row);
        }

        projects.forEach((project) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${project.name}</td>
            <td>${statusIcon(project.status)} ${project.status}</td>
            <td>${formatDate(project.updatedAt)}</td>
          `;
          tbody.appendChild(row);

          const cardTemplate = document.getElementById('projectCardTemplate');
          const node = cardTemplate.content.cloneNode(true);
          node.querySelector('.name').textContent = project.name;
          node.querySelector('.description').textContent = project.description || '';
          node.querySelector('.status').textContent = `${statusIcon(project.status)} ${project.status}`;
          cardsContainer.appendChild(node);
        });

        recent.forEach((project) => {
          const li = document.createElement('li');
          li.textContent = `${project.name} · ${formatDate(project.updatedAt)}`;
          list.appendChild(li);
        });

        document.getElementById('statProjects').textContent = recent.length;
      }
      // End project rendering section / Fin de la sección de renderizado de proyectos

      function renderTasks(tasks) {
        const tbody = document.querySelector('#tasksTable tbody');
        tbody.innerHTML = '';
        const cardsContainer = document.getElementById('tasksCards');
        cardsContainer.innerHTML = '';

        if (!tasks.length) {
          const row = document.createElement('tr');
          const cell = document.createElement('td');
          cell.colSpan = 4;
          cell.textContent = i18n[currentLanguage].tasksEmpty;
          row.appendChild(cell);
          tbody.appendChild(row);
        }

        tasks.forEach((task) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${task.name}</td>
            <td>${priorityIcon(task.priority)}</td>
            <td>${formatDate(task.dueDate)}</td>
            <td>${statusIcon(task.status)} ${task.status}${task.isCommunal ? ' · 🤝' : ''}</td>
          `;
          tbody.appendChild(row);

          const cardTemplate = document.getElementById('taskCardTemplate');
          const node = cardTemplate.content.cloneNode(true);
          node.querySelector('.name').textContent = task.name;
          node.querySelector('.description').textContent = task.description || '';
          node.querySelector('.priority').textContent = priorityIcon(task.priority);
          node.querySelector('.details').textContent = `${statusIcon(task.status)} ${task.status} · ${formatDate(task.dueDate)}`;
          cardsContainer.appendChild(node);
        });

        document.getElementById('statTasks').textContent = tasks.length;
      }
      // End task rendering section / Fin de la sección de renderizado de tareas

      function renderLogs(logs) {
        const tbody = document.querySelector('#logsTable tbody');
        tbody.innerHTML = '';
        hasOpenLog = false;

        logs.forEach((log) => {
          const row = document.createElement('tr');
          const endTime = log.endTime ? formatTime(log.endTime) : '—';
          const duration = log.duration ? `${Number(log.duration).toFixed(2)} h` : '—';
          row.innerHTML = `
            <td>${formatDate(log.date)}</td>
            <td>${formatTime(log.startTime)}</td>
            <td>${endTime}</td>
            <td>${duration}</td>
          `;
          tbody.appendChild(row);
          if (!log.endTime) {
            hasOpenLog = true;
          }
        });

        updateTimeToggle();
        const totalHours = logs.reduce((sum, log) => sum + (Number(log.duration) || 0), 0);
        document.getElementById('statHours').textContent = totalHours.toFixed(1);
      }
      // End log rendering section / Fin de la sección de renderizado de registros

      function renderUsers(users) {
        const tbody = document.querySelector('#usersTable tbody');
        if (!Array.isArray(users)) return;
        tbody.innerHTML = '';
        if (!users.length) {
          const row = document.createElement('tr');
          const cell = document.createElement('td');
          cell.colSpan = 4;
          cell.textContent = '—';
          row.appendChild(cell);
          tbody.appendChild(row);
          return;
        }
        users.forEach((user) => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${user.name}</td>
            <td>${user.email}</td>
            <td>${user.role}</td>
            <td>${user.language}</td>
          `;
          tbody.appendChild(row);
        });
      }
      // End user rendering section / Fin de la sección de renderizado de usuarios

      function configureAdminVisibility() {
        const addForm = document.getElementById('addUserForm');
        if (currentUser && currentUser.role === 'Admin') {
          addForm.style.display = 'grid';
        } else {
          addForm.style.display = 'none';
        }
      }
      // End admin visibility section / Fin de la sección de visibilidad de administrador

      function submitNewUser(event) {
        event.preventDefault();
        if (!authToken) return;
        const formData = new FormData(event.target);
        const payload = {
          name: formData.get('name'),
          email: formData.get('email'),
          role: formData.get('role'),
          language: formData.get('language'),
          notifications: formData.get('notifications')
        };
        showSpinner(true);
        google.script.run
          .withSuccessHandler((res) => {
            showSpinner(false);
            if (res && res.success) {
              showToast(i18n[currentLanguage].toastUserAdded);
              event.target.reset();
              loadAllData();
            }
          })
          .withFailureHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastError);
          })
          .addUser(payload.name, payload.email, payload.role, payload.language, payload.notifications, authToken);
      }
      // End add user section / Fin de la sección de agregar usuario

      function openProjectPrompt() {
        if (!authToken) return;
        const name = prompt(currentLanguage === 'es' ? 'Nombre del proyecto' : 'Project name');
        if (!name) return;
        const description = prompt(currentLanguage === 'es' ? 'Descripción' : 'Description') || '';
        showSpinner(true);
        google.script.run
          .withSuccessHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastProjectCreated);
            loadAllData();
          })
          .withFailureHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastError);
          })
          .createProject({ name, description }, authToken);
      }
      // End project creation prompt section / Fin de la sección de creación de proyectos vía diálogo

      function openTaskPrompt() {
        if (!authToken) return;
        const name = prompt(currentLanguage === 'es' ? 'Nombre de la tarea' : 'Task name');
        if (!name) return;
        const description = prompt(currentLanguage === 'es' ? 'Descripción' : 'Description') || '';
        const priority = prompt(currentLanguage === 'es' ? 'Prioridad (High/Medium/Low)' : 'Priority (High/Medium/Low)') || 'Medium';
        const communal = confirm(currentLanguage === 'es' ? '¿Es una tarea comunal?' : 'Is this a communal task?');
        showSpinner(true);
        google.script.run
          .withSuccessHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastTaskCreated);
            loadAllData();
          })
          .withFailureHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastError);
          })
          .createTask({ name, description, priority, isCommunal: communal }, authToken);
      }
      // End task creation prompt section / Fin de la sección de creación de tareas vía diálogo

      function runDiagnostics() {
        showSpinner(true);
        google.script.run
          .withSuccessHandler((res) => {
            showSpinner(false);
            if (!res) return;
            const container = document.getElementById('diagnosticsResults');
            container.innerHTML = '';
            const heading = document.createElement('h4');
            heading.textContent = i18n[currentLanguage].diagnosticsHeader;
            container.appendChild(heading);
            const list = document.createElement('ul');
            res.sheets.forEach((sheet) => {
              const item = document.createElement('li');
              item.textContent = `${sheet.name}: ${sheet.exists ? '✅' : '❌'} · ${sheet.headers ? 'Headers OK' : 'Headers mismatch'}`;
              list.appendChild(item);
            });
            const adminInfo = document.createElement('p');
            adminInfo.textContent = res.adminExists ? 'Admin detected ✅' : 'Admin missing ❌';
            container.appendChild(list);
            container.appendChild(adminInfo);
            showToast(i18n[currentLanguage].toastDiagnostics);
          })
          .withFailureHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastError);
          })
          .runDiagnostics(authToken);
      }
      // End diagnostics section / Fin de la sección de diagnósticos

      function toggleTimeLog() {
        if (!authToken || !currentUser) return;
        showSpinner(true);
        const action = hasOpenLog ? 'endDay' : 'startDay';
        google.script.run
          .withSuccessHandler((res) => {
            showSpinner(false);
            hasOpenLog = !hasOpenLog;
            updateTimeToggle();
            loadAllData();
            showToast(hasOpenLog ? i18n[currentLanguage].timeStarted : i18n[currentLanguage].timeEnded);
          })
          .withFailureHandler(() => {
            showSpinner(false);
            showToast(i18n[currentLanguage].toastError);
          })[action](currentUser.id, authToken);
      }
      // End time toggle section / Fin de la sección de alternar tiempo

      function updateTimeToggle() {
        const button = document.getElementById('timeToggle');
        if (hasOpenLog) {
          button.textContent = i18n[currentLanguage].endDay;
        } else {
          button.textContent = i18n[currentLanguage].startDay;
        }
      }
      // End time toggle UI section / Fin de la sección de UI del alternador de tiempo

      function updateWelcome() {
        if (!currentUser) return;
        document.getElementById('welcomeMessage').textContent = `${i18n[currentLanguage].welcome}, ${currentUser.name}`;
        document.getElementById('roleChip').textContent = currentUser.role;
        const greetingKey = currentLanguage === 'es' ? 'Buenos días' : 'Good morning';
        document.getElementById('greeting').textContent = `${greetingKey}, ${currentUser.name}`;
      }
      // End welcome update section / Fin de la sección de actualización de bienvenida

      function updateStats() {
        // Stats already updated inside render functions; kept for extensibility.
      }
      // End stats section / Fin de la sección de estadísticas

      function toggleLanguage() {
        currentLanguage = currentLanguage === 'en' ? 'es' : 'en';
        localStorage.setItem('spiralLanguage', currentLanguage);
        applyLanguage(currentLanguage);
        updateWelcome();
        updateTimeToggle();
      }
      // End language toggle section / Fin de la sección de alternar idioma

      function applyLanguage(lang) {
        document.documentElement.lang = lang;
        currentLanguage = lang;
        document.querySelectorAll('[data-i18n]').forEach((node) => {
          const key = node.getAttribute('data-i18n');
          if (i18n[lang] && i18n[lang][key]) {
            node.textContent = i18n[lang][key];
          }
        });
        document.querySelectorAll('[data-i18n-placeholder]').forEach((node) => {
          const key = node.getAttribute('data-i18n-placeholder');
          if (i18n[lang] && i18n[lang][key]) {
            node.setAttribute('placeholder', i18n[lang][key]);
          }
        });
      }
      function doGet(e) {
  return HtmlService.createHtmlOutputFromFile("sidebar")
    .setTitle("Spiral Development Group Portal");
}

      // End language application section / Fin de la sección de aplicación de idioma

      function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        localStorage.setItem('spiralTheme', currentTheme);
        applyTheme(currentTheme);
      }
      // End theme toggle section / Fin de la sección de alternar tema

      function applyTheme(theme) {
        document.body.setAttribute('data-theme', theme);
        document.getElementById('logoImage').style.setProperty('--logo-bg', theme === 'dark' ? 'rgba(255,255,255,0.12)' : '#ffffff');
      }
      // End theme application section / Fin de la sección de aplicación de tema

      function showSpinner(show) {
        const overlay = document.getElementById('loadingOverlay');
        overlay.classList.toggle('active', show);
      }
      // End spinner section / Fin de la sección del indicador de carga

      function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
      }
      // End toast section / Fin de la sección de notificaciones emergentes

      function statusIcon(status) {
        if (!status) return '⏳';
        const normalized = status.toLowerCase();
        if (normalized.includes('complete') || normalized.includes('done')) return '✅';
        if (normalized.includes('hold') || normalized.includes('pending')) return '⏳';
        if (normalized.includes('overdue') || normalized.includes('late')) return '❌';
        return '⏳';
      }
      // End status icon section / Fin de la sección de iconos de estado

      function priorityIcon(priority) {
        if (!priority) return '🟡 Medium';
        const normalized = priority.toLowerCase();
        if (normalized.startsWith('high')) return '🔴 High';
        if (normalized.startsWith('low')) return '🟢 Low';
        return '🟡 Medium';
      }
      // End priority icon section / Fin de la sección de iconos de prioridad

      function formatDate(value) {
        if (!value) return '—';
        const date = new Date(value);
        if (isNaN(date)) return value;
        return date.toLocaleDateString(currentLanguage === 'es' ? 'es-ES' : 'en-US', { year: 'numeric', month: 'short', day: 'numeric' });
      }
      // End date formatter section / Fin de la sección del formateador de fechas

      function formatTime(value) {
  if (!value) return '—';
  const date = new Date(value);
  if (isNaN(date)) return value;
  return date.toLocaleTimeString(
    currentLanguage === 'es' ? 'es-ES' : 'en-US',
    { hour: '2-digit', minute: '2-digit' }
  );
}
// End time formatter section / Fin de la sección del formateador de horas
</script>

<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("?action=serviceworker")
      .then(reg => console.log("✅ Service Worker registered:", reg))
      .catch(err => console.error("❌ Service Worker failed:", err));
  }
</script>
</body>
</html>
<!-- End sidebar.html file / Fin del archivo sidebar.html -->
